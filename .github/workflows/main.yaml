name: build and push docker images
on:
   workflow_dispatch:
   push:
     branches:
     - master
     paths:
     - 'app/**'
     - 'Dockerfile'
jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
    - name: checkout code
      uses: actions/checkout@v4

    - name: set image tag
      run: |
        tag=$(git rev-parse --short ${{ github.sha }})
        echo "IMAGE_TAG=$tag" >> $GITHUB_ENV
        echo 'Your image tag: '
        echo ${{ env.IMAGE_TAG }}
    - name: Confirm git commit SHA output
      run: echo ${{ env.IMAGE_TAG }}

    # - name: Build docker image
    #  run:
    #    make build     
  
  Test:
    needs: Build
    runs-on: ubuntu-latest
    steps:
    - name: check tag
      run: echo ${{ env.IMAGE_TAG }}
